#!/bin/bash

set -e

for f in $(ls *.res)
do
    echo "$f"
    lattc=$(awk '/CELL/{print $5}' "$f")
    echo "lattice parameter c: $lattc Angstrom"

    # Extract fifth column of data
    fracposz=$(awk '/SFAC/,/END/ {if ($0 !~ /SFAC|END/) print $5}' "$f")

    diff=$(echo "$fracposz" | sort -nr | awk 'NR==1{max=$1} END{printf "%.13f", max - $1}')
    
    thickness=$(echo "$diff $lattc" | awk '{printf "%.13f", $1 * $2 / 10}')
    echo -e "thickness : $thickness nm
done
