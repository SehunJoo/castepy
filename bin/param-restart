#!/bin/bash

set -e

color='\033[1\0;31m'
endcolor='\033[0m'

function usage {
    echo 1>&2 -e $color
    echo 1>&2 -e "usage: $(basename $0) [task]"
    echo 1>&2 -e $endcolor
    echo 1>&2 "$(basename $0)  reuse"
    echo 1>&2 "$(basename $0)  continuation"
    echo 1>&2
    exit 1
}

if [ $# -lt 1 ]; then
    usage
fi

case $1 in
    reuse | continuation)
        restart=$1
        ;;
    *)
        echo "invalid option: $1"
        usage
        ;;
esac

# main

for seed in $(ls *.param | awk 'BEGIN {FS=".param"} {print $1}')
do

    keys="continuation reuse"

    for key in $keys
    do
        nkey=$(sed -n "/^$key/p" $seed.param | wc -l)
        sed -i "/^$key/d" $seed.param
        #if [[ $nkey -ne 1 ]]
        #then
        #    sed -i "/^$key/d" $seed.param
        #    printf "%-25Vys : \n" "$key" >> $seed.param
        #fi
    done

    printf "%-25s : %s\n" "$restart" "default" >> $seed.param

    for key in $keys
    do
        sed -n "/^$key/p" $seed.param
    done

done

exit 0
