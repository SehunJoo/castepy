#!/bin/bash

set -e

unique=LiMn2O4

workdir=$(pwd)
seeds=$(ls $unique-*-slab.cell | awk 'BEGIN{FS=".cell"} {print $1}')


for seed in $seeds
do
    echo "seed: $seed"

    # cenvert cell file

    if [[ $(ls $seed.cell.* 2>/dev/null | wc -l) -ne 0 ]]
    then
        echo "skip: cell"
    else
        cell-MS $seed
    fi

    # convert param file

    if [[ $(ls $seed.param.* 2>/dev/null | wc -l) -ne 0 ]]
    then
        echo "skip: param"
    else
        param-MS $seed 1
    fi

    nlayer=${seed##*_}
    nlayer=${nlayer%-*}
    dir=${nlayer}

    # copy input fils

    if [[ -d ../$dir ]]
    then
        echo "skip: $dir detected"
    else
        mkdir -p ../$dir
        cp $seed.{cell,param} ../$dir

        cd ../$dir
        param-task singlepoint
        param-task workfunction
        #param-task geometryoptimization
        #cell-hubbardu off
        cp $CASSCR/jobscript_castep_michael.sh .
        cd $workdir

    fi
done
